<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>TCP & UDP reverse proxy With NGINX | zeroday0619's Programming Life</title><meta name=keywords content="NGINX TCP reverse proxy,NGINX UDP reverse proxy,Minecraft,Minecraft Server"><meta name=description content="NGINX를 이용해 TCP/UDP reverse proxy 서버 구축하기"><meta name=author content="zeroday0619"><link rel=canonical href=https://blog.zeroday0619.dev/posts/tcp-udp-reverse-proxy-with-nginx/><link crossorigin=anonymous href=/assets/css/stylesheet.abc7c82c3d415a6df50430738d1cbcc4c76fea558bc5a0c830d3babf78167a35.css integrity="sha256-q8fILD1BWm31BDBzjRy8xMdv6lWLxaDIMNO6v3gWejU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=https://cdn.statically.io/gh/zeroday0619/blog/main/static/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdn.statically.io/gh/zeroday0619/blog/main/static/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://cdn.statically.io/gh/zeroday0619/blog/main/static/favicon.ico><link rel=apple-touch-icon href=https://cdn.statically.io/gh/zeroday0619/blog/main/static/favicon.png><link rel=mask-icon href=https://cdn.statically.io/gh/zeroday0619/blog/main/static/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','G-4Y10MDKFEZ','auto');ga('send','pageview');}</script><meta property="og:title" content="TCP & UDP reverse proxy With NGINX"><meta property="og:description" content="NGINX를 이용해 TCP/UDP reverse proxy 서버 구축하기"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.zeroday0619.dev/posts/tcp-udp-reverse-proxy-with-nginx/"><meta property="og:image" content="https://cdn.statically.io/gh/zeroday0619/blog/main/static/home.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-09-09T15:34:23+09:00"><meta property="article:modified_time" content="2021-09-09T15:34:23+09:00"><meta property="og:site_name" content="zeroday0619's Programming Life"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cdn.statically.io/gh/zeroday0619/blog/main/static/home.png"><meta name=twitter:title content="TCP & UDP reverse proxy With NGINX"><meta name=twitter:description content="NGINX를 이용해 TCP/UDP reverse proxy 서버 구축하기"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.zeroday0619.dev/posts/"},{"@type":"ListItem","position":3,"name":"TCP \u0026 UDP reverse proxy With NGINX","item":"https://blog.zeroday0619.dev/posts/tcp-udp-reverse-proxy-with-nginx/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TCP \u0026 UDP reverse proxy With NGINX","name":"TCP \u0026 UDP reverse proxy With NGINX","description":"NGINX를 이용해 TCP/UDP reverse proxy 서버 구축하기","keywords":["NGINX TCP reverse proxy","NGINX UDP reverse proxy","Minecraft","Minecraft Server"],"articleBody":"클라우드플레어로 마인크래프트 서버 컴퓨터 IP를 완전히 숨기지 못하여 각종 공격에 취약해집니다. 이에 Origin Server IP를 숨기기 위해 NGINX로 구축한 proxy server를 경유하도록 하여 Origin Server의 IP를 노출하지 않도록 구축해보았습니다.\n구성 우분투 20.04 환경을 전제로 설명합니다.\n클라우드플레어 스펙트럼이 아닌 SRV 레코드를 사용하는 환경입니다.\n Origin Server  Proxy Server  Client\nNGINX 설정 # /etc/nginx.conf  stream { ## Minecraft JE 서버의 경우  upstream minecraft_tcp { server [server_ip]:[port]; } ## Minecraft BE 서버의 경우  # upstream minecraft_udp {  # server [server_ip]:[port];  # }  ## TCP  server { listen [port]; proxy_pass minecraft_tcp; proxy_connect_timeout 1s; } ## UDP  # server {  # listen [port] udp;  # proxy_pass minecraft_udp;  # proxy_connect_timeout 1s;  # } } upstream의 [server_ip]와 [port]에 Origin Server IP와 PORT로 변경하고 server의 listen [port]를 원하는 포트나 origin server 포트로 변경해 주고 다음 명령어를 입력하여 설정을 적용합니다.\nsudo service nginx restart NGINX 재실행 후 프록시 서버 IP 또는 프록시 서버에 설정된 도메인으로 접속이 가능합니다.\n순서대로 리버스 프록시 적용 / 미적용 origin server ip 대역은 21x.xx.xx.xx 이지만 리버스 프록시를 적용하면 origin 서버의 IP 대신 프록시 서버 IP만 표시됩니다. ","wordCount":"172","inLanguage":"en","datePublished":"2021-09-09T15:34:23+09:00","dateModified":"2021-09-09T15:34:23+09:00","author":{"@type":"Person","name":"zeroday0619"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.zeroday0619.dev/posts/tcp-udp-reverse-proxy-with-nginx/"},"publisher":{"@type":"Organization","name":"zeroday0619's Programming Life","logo":{"@type":"ImageObject","url":"https://cdn.statically.io/gh/zeroday0619/blog/main/static/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href=https://blog.zeroday0619.dev accesskey=h title="🏠 (Alt + H)">🏠</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.zeroday0619.dev/search title=검색><span>검색</span></a></li><li><a href=https://blog.zeroday0619.dev/archives title=아카이브><span>아카이브</span></a></li><li><a href=https://blog.zeroday0619.dev/categories title=카테고리><span>카테고리</span></a></li><li><a href=https://blog.zeroday0619.dev/tags title=태그><span>태그</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>TCP & UDP reverse proxy With NGINX</h1><div class=post-description>NGINX를 이용해 TCP/UDP reverse proxy 서버 구축하기</div><div class=post-meta><span title="2021-09-09 15:34:23 +0900 +0900">September 9, 2021</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;zeroday0619&nbsp;|&nbsp;<a href=https://github.com/zeroday0619/blog/edit/main/content/posts/TCP-UDP-reverse-proxy-with-NGINX.md rel="noopener noreferrer" target=_blank>수정하기</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%ea%b5%ac%ec%84%b1 aria-label=구성>구성</a></li><li><a href=#nginx-%ec%84%a4%ec%a0%95 aria-label="NGINX 설정">NGINX 설정</a></li></ul></div></details></div><div class=post-content><p>클라우드플레어로 마인크래프트 서버 컴퓨터 IP를 완전히 숨기지 못하여 각종 공격에 취약해집니다. 이에 Origin Server IP를 숨기기 위해 NGINX로 구축한 proxy server를 경유하도록 하여 Origin Server의 IP를 노출하지 않도록 구축해보았습니다.</p><h2 id=구성>구성<a hidden class=anchor aria-hidden=true href=#구성>#</a></h2><p><strong>우분투 20.04 환경을 전제로 설명합니다.</strong><br><strong>클라우드플레어 스펙트럼이 아닌 SRV 레코드를 사용하는 환경입니다.</strong></p><hr><p>Origin Server &lt;&ndash;> Proxy Server &lt;&ndash;> Client</p><h2 id=nginx-설정>NGINX 설정<a hidden class=anchor aria-hidden=true href=#nginx-설정>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx>
<span style=color:#75715e># /etc/nginx.conf
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>stream</span> {
        <span style=color:#75715e>## Minecraft JE 서버의 경우
</span><span style=color:#75715e></span>        <span style=color:#f92672>upstream</span> <span style=color:#e6db74>minecraft_tcp</span> {
                <span style=color:#f92672>server</span> <span style=color:#e6db74>[server_ip]:[port]</span>;
        }
        
        <span style=color:#75715e>## Minecraft BE 서버의 경우
</span><span style=color:#75715e></span>        <span style=color:#75715e># upstream minecraft_udp {
</span><span style=color:#75715e></span>        <span style=color:#75715e>#         server [server_ip]:[port];
</span><span style=color:#75715e></span>        <span style=color:#75715e># }
</span><span style=color:#75715e></span>
        <span style=color:#75715e>## TCP
</span><span style=color:#75715e></span>        <span style=color:#f92672>server</span> {
                <span style=color:#f92672>listen</span> <span style=color:#e6db74>[port]</span>;
                <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>minecraft_tcp</span>;
                <span style=color:#f92672>proxy_connect_timeout</span> <span style=color:#e6db74>1s</span>;
        }

        <span style=color:#75715e>## UDP
</span><span style=color:#75715e></span>        <span style=color:#75715e># server {
</span><span style=color:#75715e></span>        <span style=color:#75715e>#         listen [port] udp;
</span><span style=color:#75715e></span>        <span style=color:#75715e>#         proxy_pass minecraft_udp;
</span><span style=color:#75715e></span>        <span style=color:#75715e>#         proxy_connect_timeout 1s;
</span><span style=color:#75715e></span>        <span style=color:#75715e># }       
</span><span style=color:#75715e></span>}
</code></pre></div><p>upstream의 [server_ip]와 [port]에 Origin Server IP와 PORT로 변경하고 server의 listen [port]를 원하는 포트나 origin server 포트로 변경해 주고 다음 명령어를 입력하여 설정을 적용합니다.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo service nginx restart
</code></pre></div><p>NGINX 재실행 후 프록시 서버 IP 또는 프록시 서버에 설정된 도메인으로 접속이 가능합니다.</p><p>순서대로 리버스 프록시 적용 / 미적용
<img loading=lazy src=https://media.discordapp.net/attachments/670229327564242944/884294649861251112/unknown.png alt="리버스 프록시 적용">
<img loading=lazy src=https://media.discordapp.net/attachments/633971402550280192/885433320173867028/unknown.png alt="리버스 프록시 미적용"></p><p>origin server ip 대역은 21x.xx.xx.xx 이지만 리버스 프록시를 적용하면 origin 서버의 IP 대신 프록시 서버 IP만 표시됩니다.
<img loading=lazy src=https://media.discordapp.net/attachments/633971402550280192/885431811063308298/unknown.png alt="리버스 프록시 IP 표시함"></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.zeroday0619.dev/tags/nginx/>NGINX</a></li><li><a href=https://blog.zeroday0619.dev/tags/tcp-reverse-proxy/>TCP reverse proxy</a></li><li><a href=https://blog.zeroday0619.dev/tags/udp-reverse-proxy/>UDP reverse proxy</a></li><li><a href=https://blog.zeroday0619.dev/tags/minecraft-server/>Minecraft Server</a></li></ul><nav class=paginav><a class=next href=https://blog.zeroday0619.dev/posts/first_post/><span class=title>Next »</span><br><span>My First Post</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=zeroday0619/blog data-repo-id="MDEwOlJlcG9zaXRvcnkzODk1OTAxNzI=" data-category=comment data-category-id=DIC_kwDOFzisnM4B-ecp data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=1 data-theme=dark crossorigin=anonymous async></script><style>.giscus,.giscus-frame{width:100%;border:none}</style></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.zeroday0619.dev>zeroday0619's Programming Life</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu')
if(menu){menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>